---
version: '3'

tasks:
  secrets:
    desc: Decrypt secrets in $dir directory
    dir: '{{.dir}}'
    silent: true
    vars:
      dir: '{{.dir | default .USER_WORKING_DIR}}'
      string: '{{.string}}'
    cmds:
      - find . -type f \( -name "*.sops.yaml" -o -name "secrets.yaml" \) -exec sh -c "(sops -d {} | grep {{.string}}) && echo '{}'" \;
