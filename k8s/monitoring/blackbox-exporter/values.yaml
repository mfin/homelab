prometheus-blackbox-exporter:
  fullnameOverride: blackbox-exporter
  pspEnabled: false
  ingress:
    enabled: true
    className: traefik
    annotations:
      traefik.ingress.kubernetes.io/router.entrypoints: websecure
      traefik.ingress.kubernetes.io/router.middlewares: traefik-authelia@kubernetescrd
  securityContext:
    readOnlyRootFilesystem: true
    allowPrivilegeEscalation: false
    capabilities:
      add: ["NET_RAW"]
  config:
    modules:
      http_2xx:
        prober: http
        timeout: 5s
        http:
          valid_http_versions: ["HTTP/1.1", "HTTP/2.0"]
          follow_redirects: true
          preferred_ip_protocol: "ip4"
      icmp:
        prober: icmp
        timeout: 20s
        icmp:
          preferred_ip_protocol: "ip4"
  serviceMonitor:
    enabled: false
  prometheusRule:
    enabled: true
    additionalLabels:
      app: prometheus-operator
      release: prometheus
    rules:
      - alert: BlackboxProbeFailed
        expr: probe_success == 0
        for: 5m
        labels:
          severity: critical
        annotations:
          description: |-
            The host {{ $labels.instance }} with module {{ $labels.module }} is currently unreachable
