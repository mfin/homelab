app-template:
  initContainers:
    01-init-db:
      image: ghcr.io/onedr0p/postgres-init:14.8
      imagePullPolicy: IfNotPresent
      envFrom:
        - secretRef:
            name: postgres
  controller:
    annotations:
      reloader.stakater.com/auto: "true"
    type: statefulset
    replicas: 1
  image:
    repository: ghcr.io/mfin/n8n
    tag: rolling@sha256:5ea4bac5837926a9c0642bc7787780990cbec83bd088f7392e9d866ed963f71f
  command: ["n8n"]
  env:
    GENERIC_TIMEZONE: Europe/Ljubljana
    N8N_USER_FOLDER: /config
    N8N_PORT: &port 80
    N8N_EMAIL_MODE: smtp
    N8N_METRICS: true
  envFrom:
    - secretRef:
        name: n8n

  service:
    main:
      ports:
        http:
          port: *port

  probes:
    liveness: &probes
      enabled: true
      custom: true
      spec:
        httpGet:
          path: /healthz
          port: *port
        initialDelaySeconds: 0
        periodSeconds: 10
        timeoutSeconds: 1
        failureThreshold: 3
    readiness: *probes
    startup:
      enabled: false

  ingress:
    main:
      enabled: true
      ingressClassName: "traefik"
      annotations:
        traefik.ingress.kubernetes.io/router.entrypoints: websecure
        traefik.ingress.kubernetes.io/router.middlewares: traefik-authelia@kubernetescrd
        hajimari.io/enable: "true"
        hajimari.io/icon: mdi:workflow
        hajimari.io/appName: n8n
        hajimari.io/info: Workflow automation for technical people
