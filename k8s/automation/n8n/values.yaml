app-template:
  controller:
    type: statefulset
    replicas: 1
  image:
    repository: ghcr.io/n8n-io/n8n
    tag: 0.229.0
  command: ["n8n"]
  env:
    GENERIC_TIMEZONE: Europe/Ljubljana
    N8N_USER_FOLDER: /config
    N8N_PORT: &port 80
    N8N_EMAIL_MODE: smtp
    N8N_METRICS: true
  envFrom:
    - secretRef:
        name: n8n

  service:
    main:
      ports:
        http:
          port: *port

  probes:
    liveness: &probes
      enabled: true
      custom: true
      spec:
        httpGet:
          path: /healthz
          port: *port
        initialDelaySeconds: 0
        periodSeconds: 10
        timeoutSeconds: 1
        failureThreshold: 3
    readiness: *probes
    startup:
      enabled: false

  ingress:
    main:
      enabled: true
      ingressClassName: "traefik"
      annotations:
        traefik.ingress.kubernetes.io/router.entrypoints: websecure
        traefik.ingress.kubernetes.io/router.middlewares: traefik-authelia@kubernetescrd
        hajimari.io/enable: "true"
        hajimari.io/icon: mdi:workflow
        hajimari.io/appName: n8n
        hajimari.io/info: Workflow automation for technical people

  persistence:
    config:
      enabled: true
      existingClaim: n8n

  resources:
    requests:
      cpu: 22m
      memory: 164M
    limits:
      memory: 262M
