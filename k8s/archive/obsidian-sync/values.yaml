app-template:
  controller:
    type: statefulset
    annotations:
      reloader.stakater.com/auto: "true"

  initContainers:
    init-config:
      image: public.ecr.aws/docker/library/busybox:latest
      imagePullPolicy: IfNotPresent
      command: ["/bin/sh", "-c", "cp /tmp/config/*.ini /default.d/; ls -lrt /default.d;"]
      volumeMounts:
        - { name: config-file, mountPath: /tmp/config }
        - { name: config-storage, mountPath: /default.d }

  image:
    repository: public.ecr.aws/docker/library/couchdb
    tag: 3.3.1

  envFrom:
    - secretRef:
        name: obsidian-sync

  service:
    main:
      ports:
        http:
          port: 5984

  ingress:
    main:
      enabled: true
      ingressClassName: traefik
      annotations:
        hajimari.io/icon: mdi:note-outline

  persistence:
    data:
      enabled: true
      existingClaim: obsidian-sync
      mountPath: /opt/couchdb/data
    config-file:
      enabled: true
      type: configMap
      name: obsidian-sync
      mountPath: "-"
    config-storage:
      enabled: true
      type: emptyDir
      mountPath: /opt/couchdb/etc/default.d

  resources:
    requests:
      cpu: 10m
      memory: 50Mi
    limits:
      memory: 250Mi
