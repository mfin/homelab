apiVersion: batch/v1
kind: CronJob
metadata:
  name: nextdns-ip
  namespace: {{ .Release.Namespace }}
spec:
  schedule: "@daily"
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: nextdns-ip
            image: curlimages/curl:8.1.2
            imagePullPolicy: IfNotPresent
            env:
            - name: NEXTDNS_ID
              value: {{ .Values.nextdns.id }}
            - name: NEXTDNS_SECRET
              value: {{ .Values.nextdns.secret }}
            args: ["-sS", "-X", "POST", "https://link-ip.nextdns.io/$(NEXTDNS_ID)/$(NEXTDNS_SECRET)"]
          restartPolicy: OnFailure
