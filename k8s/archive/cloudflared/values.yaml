app-template:
  priorityClassName: system-cluster-critical
  controller:
    replicas: 1
    annotations:
      reloader.stakater.com/auto: "true"
  image:
    repository: cloudflare/cloudflared
    tag: 2023.2.2
  env:
    TZ: "Europe/Ljubljana"
  args:
    - tunnel
    - --config
    - /etc/cloudflared/config.yaml
    - --metrics=0.0.0.0:3333
    - --no-autoupdate
    - run
  service:
    main:
      ports:
        http:
          enabled: false
        metrics:
          enabled: true
          primary: true
          port: 3333
          protocol: TCP
  serviceMonitor:
    main:
      enabled: true
      endpoints:
        - port: metrics
          scheme: http
          path: /metrics
  persistence:
    config:
      enabled: true
      type: configMap
      name: cloudflared-config
      mountPath: /etc/cloudflared/config.yaml
      subPath: config.yaml
      readOnly: true
    tunnel:
      enabled: true
      type: secret
      name: cloudflared-secret
      mountPath: /etc/cloudflared/creds.json
      subPath: creds.json
      readOnly: true
  probes:
    liveness:
      enabled: true
      custom: true
      spec:
        initialDelaySeconds: 0
        periodSeconds: 10
        timeoutSeconds: 1
        failureThreshold: 3
        httpGet:
          path: /ready
          port: 3333
          scheme: HTTP
    readiness:
      enabled: true
      custom: true
      spec:
        initialDelaySeconds: 0
        periodSeconds: 10
        timeoutSeconds: 1
        failureThreshold: 3
        httpGet:
          path: /ready
          port: 3333
          scheme: HTTP
    startup:
      enabled: true
      custom: true
      spec:
        initialDelaySeconds: 0
        timeoutSeconds: 1
        periodSeconds: 5
        failureThreshold: 30
        httpGet:
          path: /ready
          port: 3333
          scheme: HTTP
