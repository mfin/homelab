---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: oidc-client-secret
spec:
  refreshInterval: 1h0m0s
  secretStoreRef:
    kind: ClusterSecretStore
    name: bitwarden-secrets-manager
  target:
    name: oidc-client-secret
    template:
      data:
        client-secret: "{{ `{{ .clientSecret }}` }}"
  data:
  - secretKey: clientSecret
    remoteRef:
      key: "ENVOY_OIDC_CLIENT_SECRET"
---
apiVersion: gateway.envoyproxy.io/v1alpha1
kind: SecurityPolicy
metadata:
  name: oidc
spec:
  targetRefs:
    - group: gateway.networking.k8s.io
      kind: HTTPRoute
      name: radarr-4k
  oidc:
    provider:
      issuer: "https://pocket.mfin.app"
    clientID: "envoy-gateway"
    clientSecret:
      name: "oidc-client-secret"
