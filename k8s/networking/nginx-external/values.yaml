ingress-nginx:
  fullnameOverride: nginx-external
  controller:
    replicaCount: 1
    service:
      annotations:
        io.cilium/lb-ipam-ips: 10.10.0.246
      externalTrafficPolicy: Local
    ingressClassResource:
      name: external
      default: false
      controllerValue: k8s.io/external
    admissionWebhooks:
      objectSelector:
        matchExpressions:
          - key: ingress-class
            operator: In
            values: ["external"]
    allowSnippetAnnotations: true
    enableAnnotationValidations: true
    config:
      client-body-buffer-size: 100M
      client-body-timeout: 120
      client-header-timeout: 120
      enable-brotli: "true"
      enable-real-ip: "true"
      hsts-max-age: 31449600
      keep-alive-requests: 10000
      keep-alive: 120
      log-format-escape-json: "true"
      log-format-upstream: >
        {"time": "$time_iso8601", "remote_addr": "$proxy_protocol_addr", "x_forwarded_for": "$proxy_add_x_forwarded_for", "request_id": "$req_id", "remote_user": "$remote_user", "bytes_sent": $bytes_sent, "request_time": $request_time, "status": $status, "vhost": "$host", "request_proto": "$server_protocol", "path": "$uri", "request_query": "$args", "request_length": $request_length, "duration": $request_time, "method": "$request_method", "http_referrer": "$http_referer", "http_user_agent": "$http_user_agent"}

      proxy-body-size: 0
      proxy-buffer-size: 16k
      ssl-protocols: TLSv1.3 TLSv1.2
      whitelist-source-range: 173.245.48.0/20,103.21.244.0/22,103.22.200.0/22,103.31.4.0/22,141.101.64.0/18,108.162.192.0/18,190.93.240.0/20,188.114.96.0/20,197.234.240.0/22,198.41.128.0/17,162.158.0.0/15,104.16.0.0/13,104.24.0.0/14,172.64.0.0/13,131.0.72.0/22,2400:cb00::/32,2606:4700::/32,2803:f800::/32,2405:b500::/32,2405:8100::/32,2a06:98c0::/29,2c0f:f248::/32,10.0.0.0/8,192.168.0.0/16,172.16.0.0/12
    metrics:
      enabled: true
      serviceMonitor:
        enabled: true
        namespaceSelector:
          any: true
    extraArgs:
      default-ssl-certificate: cert-manager/homelab-cert
    topologySpreadConstraints:
      - maxSkew: 1
        topologyKey: kubernetes.io/hostname
        whenUnsatisfiable: DoNotSchedule
        labelSelector:
          matchLabels:
            app.kubernetes.io/name: nginx-external
            app.kubernetes.io/component: controller
    resources:
      requests:
        cpu: 100m
        memory: 250Mi
      limits:
        memory: 500Mi
  defaultBackend:
    enabled: false
