apiVersion: v1
kind: ConfigMap
metadata:
  name: cloudflared-config
data:
  config.yaml: |-
    tunnel: "{{ .Values.cloudflared.tunnelId }}"
    credentials-file: /etc/cloudflared/creds.json
    metrics: "0.0.0.0:8080"
    no-autoupdate: true
    originRequest:
      connectTimeout: 30s

    ingress:
      - hostname: "argocd-webhook.{{ .Values.homelab.domain }}"
        service: "https://traefik.traefik.svc.cluster.local"
        originRequest:
          originServerName: {{ .Values.cloudflared.cname }}
      - hostname: "*.{{ .Values.homelab.domain }}"
        service: "https://nginx-external-controller.nginx-external.svc.cluster.local"
        originRequest:
          originServerName: {{ .Values.cloudflared.tempCname }}
      - service: http_status:404
