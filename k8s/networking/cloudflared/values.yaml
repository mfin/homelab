app-template:
  priorityClassName: system-cluster-critical
  controller:
    replicas: 1
    annotations:
      reloader.stakater.com/auto: "true"
  image:
    repository: cloudflare/cloudflared
    tag: 2023.7.2
  env:
    TZ: "Europe/Ljubljana"
  args:
    - tunnel
    - --config
    - /etc/cloudflared/config.yaml
    - run
  service:
    main:
      ports:
        http:
          port: 8080
  serviceMonitor:
    main:
      enabled: true
      endpoints:
        - port: http
          scheme: http
          path: /metrics
  persistence:
    config:
      enabled: true
      type: configMap
      name: cloudflared-config
      mountPath: /etc/cloudflared/config.yaml
      subPath: config.yaml
      readOnly: true
    tunnel:
      enabled: true
      type: secret
      name: cloudflared-secret
      mountPath: /etc/cloudflared/creds.json
      subPath: creds.json
      readOnly: true
  probes:
    liveness: &probes
      enabled: true
      custom: true
      spec:
        httpGet:
          path: /ready
          port: http
        initialDelaySeconds: 0
        periodSeconds: 10
        timeoutSeconds: 1
        failureThreshold: 3
    readiness: *probes
    startup:
      enabled: false
