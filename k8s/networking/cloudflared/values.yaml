app-template:
  priorityClassName: system-cluster-critical
  controller:
    replicas: 1
  image:
    repository: cloudflare/cloudflared
    tag: 1315-645e22744c07
  env:
    TZ: "Europe/Ljubljana"
  args:
    - tunnel
    - --config
    - /etc/cloudflared/config.yaml
    - --metrics=0.0.0.0:3333
    - --no-autoupdate
    - run
  service:
    main:
      enabled: false
  persistence:
    config:
      enabled: true
      type: configMap
      name: cloudflared-config
      mountPath: /etc/cloudflared/config.yaml
      subPath: config.yaml
      readOnly: true
    tunnel:
      enabled: true
      type: secret
      name: cloudflared-secret
      mountPath: /etc/cloudflared/creds.json
      subPath: creds.json
      readOnly: true
  podAnnotations:
    configmap.reloader.stakater.com/reload: cloudflared-config
    secret.reloader.stakater.com/reload: cloudflared-secret
  probes:
    liveness:
      enabled: true
      custom: true
      spec:
        initialDelaySeconds: 0
        periodSeconds: 10
        timeoutSeconds: 1
        failureThreshold: 3
        httpGet:
          path: /ready
          port: 3333
          scheme: HTTP
    readiness:
      enabled: true
      custom: true
      spec:
        initialDelaySeconds: 0
        periodSeconds: 10
        timeoutSeconds: 1
        failureThreshold: 3
        httpGet:
          path: /ready
          port: 3333
          scheme: HTTP
    startup:
      enabled: true
      custom: true
      spec:
        initialDelaySeconds: 0
        timeoutSeconds: 1
        periodSeconds: 5
        failureThreshold: 30
        httpGet:
          path: /ready
          port: 3333
          scheme: HTTP
