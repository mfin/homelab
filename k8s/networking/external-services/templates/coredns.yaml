---
kind: Service
apiVersion: v1
metadata:
 name: coredns
 labels:
  external: coredns
spec:
 type: ClusterIP
 ports:
 - name: metrics
   port: {{ .Values.coredns.port }}
   targetPort: {{ .Values.coredns.port }}
---
kind: Endpoints
apiVersion: v1
metadata:
 name: coredns
subsets:
 - addresses:
     - ip: {{ .Values.coredns.ip }}
   ports:
	   - name: metrics
       port: {{ .Values.coredns.port }}
---
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  labels:
  name: coredns
spec:
  endpoints:
  - path: /metrics
    port: metrics
    scheme: http
  selector:
    matchLabels:
      external: coredns
